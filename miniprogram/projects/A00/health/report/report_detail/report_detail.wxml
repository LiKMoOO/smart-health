<view class="main">
  <view class="top-bar bar">
    <view class="title">体检报告详情</view>
  </view>

  <view wx:if="{{!isLoad}}" class="loading">
    <view class="loading-icon"></view>
    <view class="loading-text">加载中...</view>
  </view>

  <block wx:elif="{{isLoad && report}}">
    <view class="report-header">
      <view class="hospital">{{report.hospital}}</view>
      <view class="date">{{report.reportDate}}</view>
    </view>
    <view class="report-content">
      <view class="type">{{report.reportType}}</view>
      <view class="summary">{{report.summary}}</view>
    </view>
    <view class="report-footer">
      <button class="btn-primary" bindtap="bindViewFileTap">查看原始报告</button>
      <button class="btn-default" bindtap="bindAnalyzeByAI">AI 智能分析</button>
    </view>
  </block>

  <view wx:elif="{{isLoad && !report}}" class="no-data">
    <image class="icon-empty" src="/images/icon/empty.png"></image>
    <view class="hint">报告不存在或已被删除</view>
  </view>

  <!-- AI分析结果弹窗 -->
  <view class="modal" wx:if="{{showAiResult && report.aiAnalysis}}">
    <view class="modal-mask" bindtap="bindCloseAiResult"></view>
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-title">AI 健康分析报告</view>
        <view class="modal-close" bindtap="bindCloseAiResult">×</view>
      </view>
      <view class="modal-body">
        <view class="ai-result-section">
          <view class="ai-result-title">健康建议</view>
          <view class="ai-result-content">{{report.aiAnalysis.suggestion}}</view>
        </view>
        <view class="ai-result-section">
          <view class="ai-result-title">健康风险</view>
          <view class="ai-result-content">
            <text class="ai-risk-level {{report.aiAnalysis.riskLevel === '高' ? 'high' : (report.aiAnalysis.riskLevel === '中' ? 'medium' : 'low')}}">{{report.aiAnalysis.riskLevel}}</text>
          </view>
        </view>
        <view class="ai-result-section">
          <view class="ai-result-title">详细分析</view>
          <view class="ai-result-content ai-details">{{report.aiAnalysis.details}}</view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn-close" bindtap="bindCloseAiResult">关闭</button>
      </view>
    </view>
  </view>
</view> 